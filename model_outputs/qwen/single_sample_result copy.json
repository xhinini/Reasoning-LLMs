{
  "sample_id": "BigCodeBench/797",
  "task_type": "code_generation_bcb_simple",
  "prompt": "# Code Generation Task (ID: BigCodeBench/797)\n\n## Problem Description\nCount the total number of brackets (i.e., '(', ')', '{', '}', '[', ']') in a pandas DataFrame. >>> df = pd.DataFrame({'Test': ['(a)', 'b', '[[[[))c']}) >>> task_func(df) 8\nNote that: The function uses a specific pattern '[(){}[\\]]' to identify brackets.\nThe function should raise the exception for: TypeError: If input is not a DataFrame\nThe function should output with:\n    int: The total number of brackets.\nYou should write self-contained code starting with:\n```\nimport re\nimport pandas as pd\ndef task_func(df: pd.DataFrame) -> int:\n```\n\nPlease carefully study this software engineering problem, conduct a comprehensive analysis, and provide a solution with your reasoning process.\n\nAs an expert software developer, your task is to:\n1. Understand the requirements \n2. Design an approach to solve the problem\n3. Implement the solution in code\n4. Verify the correctness of your solution\n\nFormat to Follow:\n\n### Reasoning Process:\n[Please explain your thinking process step by step, with each logical step in a separate paragraph, and use a format such as <step 1> to label each step.]\n\n<step 1> Specific thinking content of this step\n<step 2> Specific thinking content of this step\n...\n<step n> Specific thinking content of this step\n\n### Solution:\n[Provide your complete code implementation here. Ensure it is functional, efficient, and addresses all requirements.]",
  "content": "### Reasoning Process:\n<step 1> The problem requires counting all occurrences of brackets ('(', ')', '{', '}', '[', ']') in a pandas DataFrame. The solution must handle any DataFrame input, raise a TypeError if invalid, and use regex for bracket detection.\n\n<step 2> First, validate the input using `isinstance(df, pd.DataFrame)` to ensure it's a DataFrame. If not, raise the specified exception.\n\n<step 3> To process all cells, use `df.stack()` to convert the DataFrame into a Series of all elements, making iteration straightforward.\n\n<step 4> For each element in the Series, convert it to a string to handle non-string values. Use a regex pattern `r'[][(){}]'` to match all six brackets. This pattern avoids escaping by placing `]` first in the character class.\n\n<step 5> Count matches in each string using `re.findall()` and sum the total across all elements. Return the cumulative count.\n\n### Solution:\n```python\nimport re\nimport pandas as pd\n\ndef task_func(df: pd.DataFrame) -> int:\n    if not isinstance(df, pd.DataFrame):\n        raise TypeError(\"Input must be a pandas DataFrame\")\n    \n    total = 0\n    for element in df.stack():\n        s = str(element)\n        matches = re.findall(r'[][(){}]', s)\n        total += len(matches)\n    return total\n```",
  "reasoning_content": "### Reasoning Process:\n<step 1> The problem requires counting all occurrences of brackets ('(', ')', '{', '}', '[', ']') in a pandas DataFrame. The solution must handle any DataFrame input, raise a TypeError if invalid, and use regex for bracket detection.\n\n<step 2> First, validate the input using `isinstance(df, pd.DataFrame)` to ensure it's a DataFrame. If not, raise the specified exception.\n\n<step 3> To process all cells, use `df.stack()` to convert the DataFrame into a Series of all elements, making iteration straightforward.\n\n<step 4> For each element in the Series, convert it to a string to handle non-string values. Use a regex pattern `r'[][(){}]'` to match all six brackets. This pattern avoids escaping by placing `]` first in the character class.\n\n<step 5> Count matches in each string using `re.findall()` and sum the total across all elements. Return the cumulative count.",
  "error": null,
  "duration": 47.18016695976257,
  "original_sample": {
    "task_id": "BigCodeBench/797",
    "prompt": "Count the total number of brackets (i.e., '(', ')', '{', '}', '[', ']') in a pandas DataFrame. >>> df = pd.DataFrame({'Test': ['(a)', 'b', '[[[[))c']}) >>> task_func(df) 8\nNote that: The function uses a specific pattern '[(){}[\\]]' to identify brackets.\nThe function should raise the exception for: TypeError: If input is not a DataFrame\nThe function should output with:\n    int: The total number of brackets.\nYou should write self-contained code starting with:\n```\nimport re\nimport pandas as pd\ndef task_func(df: pd.DataFrame) -> int:\n```",
    "canonical_solution": "\n    if not isinstance(df, pd.DataFrame):\n        raise TypeError(\"df should be a DataFrame.\")\n\n    # Constants\n    BRACKETS_PATTERN = '[(){}[\\]]'\n\n    return df.applymap(\n        lambda x: len(re.findall(BRACKETS_PATTERN, str(x)))\n        ).sum().sum()",
    "test": "import unittest\nimport pandas as pd\nfrom faker import Faker\nfake = Faker()\nclass TestCases(unittest.TestCase):\n    def test_wrong_input(self):\n        # test with non dataframe input\n        self.assertRaises(Exception, task_func, 1)\n        self.assertRaises(Exception, task_func, ['a'])\n        self.assertRaises(Exception, task_func, {'a': 1})\n        self.assertRaises(Exception, task_func, 'asdf')\n    def test_case_1(self):\n        # Test with DataFrame containing no brackets\n        df = pd.DataFrame({\n            'A': [fake.word() for _ in range(5)],\n            'B': [fake.word() for _ in range(5)]\n        })\n        result = task_func(df)\n        self.assertEqual(result, 0)\n    def test_case_2(self):\n        # Test with DataFrame containing a few brackets\n        df = pd.DataFrame({\n            'A': ['(a)', 'b', 'c', '{d}', 'e'],\n            'B': ['f', '[g]', 'h', 'i', 'j']\n        })\n        result = task_func(df)\n        self.assertEqual(result, 6)\n    def test_case_3(self):\n        # Test with DataFrame where every entry contains a bracket\n        df = pd.DataFrame({\n            'A': ['(a)', '{b}', '[c]', '(d)', '[e]'],\n            'B': ['{f}', '(g)', '[h]', '{i}', '(j)']\n        })\n        result = task_func(df)\n        self.assertEqual(result, 20)\n    def test_case_4(self):\n        # Test with DataFrame containing mixed characters and brackets\n        df = pd.DataFrame({\n            'A': ['(a1)', '{b2}', 'c3', 'd4', '[e5]'],\n            'B': ['f6', 'g7', '[h8]', 'i9', 'j0']\n        })\n        result = task_func(df)\n        self.assertEqual(result, 8)\n    def test_case_5(self):\n        # Test with DataFrame containing numbers, letters, and brackets\n        df = pd.DataFrame({\n            'A': ['(123]', '{{456}', '789', '0ab', '[cde]'],\n            'B': ['fgh', 'ijk', '[)lmn]', 'opq', 'rst']\n        })\n        result = task_func(df)\n        self.assertEqual(result, 10)\n    def test_empty(self):\n        # test with empty df\n        df = pd.DataFrame()\n        result = task_func(df)\n        self.assertEqual(result, 0)\n    def test_only(self):\n        # test df with only parenthesis as entries\n        df = pd.DataFrame({\n            'test': ['[[()]', '{}{{{{{{))))}}', '[]'],\n            'asdf': ['{]', '()))', '))}}]]']\n        })\n        result = task_func(df)\n        self.assertEqual(result, 33)",
    "entry_point": "task_func",
    "split_type": "instruct"
  }
}